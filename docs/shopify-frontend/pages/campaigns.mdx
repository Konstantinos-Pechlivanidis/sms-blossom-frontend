# Campaigns Page Contract

## Purpose
The Campaigns page provides a professional campaign creation wizard with live SMS preview, campaign management, and audience targeting capabilities.

## Key Components Used
- **PageHeader**: Standard page header with help system
- **IPhoneSmsPreview**: Live SMS preview with character/segment counting
- **ActionWithHelp**: Primary action with help tooltip
- **FormScaffold**: Professional form wrapper with validation
- **HelpDialog**: Contextual help for campaign creation

## Data Dependencies
- **Query Keys**: `['campaigns', shop]`, `['segments', shop]`
- **Hooks**: `useQuery` for campaigns and segments
- **Mutations**: `useMutation` for campaign creation

## Backend Endpoints
| Method | Path | Purpose |
|--------|------|---------|
| `GET` | `/campaigns` | List all campaigns |
| `POST` | `/campaigns` | Create new campaign |
| `GET` | `/segments` | List available segments |
| `POST` | `/campaigns/estimate` | Estimate campaign cost |

## User Actions
| Action | This button does... | Backend Operation |
|--------|-------------------|-------------------|
| **Create Campaign** | Opens campaign creation wizard | N/A (frontend modal) |
| **Add first_name** | Inserts personalization variable | N/A (frontend state) |
| **Add discount_code** | Inserts discount variable | N/A (frontend state) |
| **Create Campaign (Wizard)** | Creates campaign with form data | `POST /campaigns` |
| **Reset** | Clears form and resets state | N/A (frontend state) |
| **Open Campaign** | Navigates to campaign details | N/A (frontend navigation) |
| **Help** | Opens contextual help dialog | N/A (frontend modal) |

## Campaign Creation Wizard Steps

### Step 1: Audience
- **Campaign Name**: Text input with placeholder
- **Target Segment**: Dropdown with customer counts
- **Segment Info**: Shows targeting details when selected

### Step 2: Message
- **SMS Message**: Multiline text input with personalization help
- **Variable Buttons**: Quick insert for common variables
- **Live Preview**: Real-time iPhone-style SMS preview
- **Character Counter**: GSM/Unicode detection and segment counting

### Step 3: Schedule
- **Schedule At**: Optional datetime picker
- **Batch Size**: Number input for message batching
- **Help Text**: Guidance for each field

## Empty States
- **No Campaigns**: EmptyState with "Create your first campaign" action
- **No Segments**: Shows "All customers" option only
- **Loading**: Spinner with "Loading campaigns..." text

## Loading States
- **Campaigns Loading**: Spinner with loading text
- **Segments Loading**: Disabled segment dropdown
- **Creation Loading**: Primary button shows loading state

## Error States
- **Campaign Load Error**: Critical banner with error message
- **Creation Error**: Toast notification for creation failures
- **Network Error**: Toast notification for API failures

## Success States
- **Campaign Created**: Success toast and navigation to campaign details
- **Form Reset**: All fields cleared to default values

## Live SMS Preview Features
- **iPhone Frame**: Realistic mobile device mockup
- **Message Bubble**: Blue bubble with white text
- **Variable Highlighting**: Template variables highlighted in yellow
- **Character Counting**: Real-time character and segment counting
- **GSM/Unicode Detection**: Automatic encoding detection
- **Sender Label**: Customizable sender name

## Accessibility
- **Keyboard Navigation**: Full keyboard support for all form elements
- **Screen Reader**: Proper labels and ARIA attributes
- **Focus Management**: Clear focus indicators and logical tab order
- **Touch Targets**: 44x44pt minimum for mobile

## Mobile Responsiveness
- **Grid Layout**: Responsive 2-column layout (stacked on mobile)
- **Preview**: Sticky preview on desktop, stacked on mobile
- **Form Fields**: Full-width inputs on mobile
- **Touch Targets**: Optimized for touch interaction

## Performance Considerations
- **Live Preview**: Debounced updates to prevent excessive re-renders
- **Form State**: Optimized state management for large forms
- **Image Loading**: Lazy loading for campaign images
- **Data Caching**: 5-minute cache for segments and campaigns